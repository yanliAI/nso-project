<script setup lang="ts">
import { onMounted, reactive, ref } from 'vue';

import { Download, Search, Refresh, Plus } from '@element-plus/icons-vue';
import {
  ElButton,
  ElCol,
  ElForm,
  ElFormItem,
  ElInput,
  ElPagination,
  ElRow,
  ElSelect,
  ElMessage,
  ElTable,
  ElTableColumn,
} from 'element-plus';

import { getSysRelateInfo } from '#/api';

// 头部表单
const queryFormRef = ref();
const queryForm = reactive({});

// 表格
const data = reactive({
  tableData: [],
  pageInfo: {
    pageSize: 10,
    pageNo: 1,
    total: 0,
  },
});

onMounted(() => {
  queryData();
});

// 查询数据
async function queryData() {
  try {
    const res = await getSysRelateInfo({
      pageSize: data.pageInfo.pageSize,
      pageNo: data.pageInfo.pageNo,
      ...queryForm,
    });
    if (res) {
      data.tableData = res.list;
      data.pageInfo.total = res.total;
    }
  } catch (error) {
    console.error('查询数据失败:', error);
  }
}

// 重置查询
function reset() {
  queryFormRef.value?.resetFields();
  queryData();
}

// 分页查询
function currentChange(val: any) {
  data.pageInfo.pageNo = val;
  queryData();
}

function handleSizeChange(val: number) {
  data.pageInfo.pageSize = val;
  queryData();
}
</script>
<template>
  <div>
    <div style="padding: 0 20px">
      <ElForm
        :inline="true"
        ref="queryFormRef"
        :model="queryForm"
        label-position="left"
      >
        <ElFormItem label="系统名称:" prop="origionSysName">
          <ElInput v-model="queryForm.origionSysName" clearable />
        </ElFormItem>
        <ElFormItem label="IP地址:" prop="sourceIp">
          <ElInput v-model="queryForm.sourceIp" clearable />
        </ElFormItem>
        <ElFormItem style="width: auto">
          <ElButton type="primary" :icon="Search" @click="queryData"
            >查询</ElButton
          >
          <ElButton type="info" :icon="Refresh" @click="reset">重置</ElButton>
        </ElFormItem>
      </ElForm>
    </div>
    <div style="padding: 0 20px 10px 20px">
      <ElTable ref="tab" border stripe :data="data.tableData" height="710px">
        <ElTableColumn type="index" align="center"/>
        <ElTableColumn label="源系统" align="center">
          <ElTableColumn prop="sourceIp" label="IP地址" align="center"/>
          <ElTableColumn prop="sourcePort" label="端口" align="center"/>
          <ElTableColumn prop="origionSysName" label="系统名称" align="center" show-overflow-tooltip/>
          <ElTableColumn prop="sourceNetworkPartition" label="系统所属网络分区" align="center"/>
        </ElTableColumn>
        <ElTableColumn prop="dataExchangeGateway" align="center" label="数据交换网关/隔离设备" />
        <ElTableColumn label="目标系统" align="center">
          <ElTableColumn prop="targetIp" label="IP地址" align="center"/>
          <ElTableColumn prop="targetPort" label="端口" align="center"/>
          <ElTableColumn prop="targetSysName" label="系统名称" align="center" show-overflow-tooltip/>
          <ElTableColumn prop="targetNetworkPartition" label="系统所属网络分区" align="center"/>
        </ElTableColumn>
      </ElTable>
    </div>
    <div style="padding-left: 20px; display: flex">
      <ElPagination
        v-model:current-page="data.pageInfo.pageNo"
        v-model:page-size="data.pageInfo.pageSize"
        :total="data.pageInfo.total"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="currentChange"
      />
    </div>
  </div>
</template>
<style lang="less" scoped>
// :deep(.el-form-item) {
//   width: 270px;
//   .el-form-item__content {
//     display: flex;
//     justify-content: flex-end;
//   }
//   .el-form-item__label {
//     width: 100px;
//     text-align: right;
//     font-size: 14px;
//     font-weight: 500;
//     // line-height: 32px;
//     color: #515a6e;
//   }
// }
</style>
