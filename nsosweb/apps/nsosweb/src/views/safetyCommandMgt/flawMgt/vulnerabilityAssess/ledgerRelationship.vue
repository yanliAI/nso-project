<script setup lang="ts">
import { onMounted, reactive, ref } from 'vue';

import { Download, Search, Refresh, Plus } from '@element-plus/icons-vue';
import {
  ElButton,
  ElCol,
  ElForm,
  ElFormItem,
  ElInput,
  ElPagination,
  ElRow,
  ElSelect,
  ElMessage,
  ElTable,
  ElTableColumn,
} from 'element-plus';

import { insertAppDomain, searchAppDomain, getAllAppDomain,searchAppDomainSystemInfo } from '#/api';

// 头部表单
const queryFormRef = ref();
const queryForm = reactive({});

const appDomains = ref([]);
// 表格
const data = reactive({
  tableData: [],
  pageInfo: {
    pageSize: 10,
    pageNo: 1,
    total: 0,
  },
});

onMounted(() => {
  queryData();
  getAppDomain();
});

// 查询数据
async function queryData() {
  try {
    const res = await searchAppDomainSystemInfo({
      pageSize: data.pageInfo.pageSize,
      pageNo: data.pageInfo.pageNo,
      ...queryForm,
    });
    if (res) {
      data.tableData = res.list;
      data.pageInfo.total = res.total;
    }
  } catch (error) {
    console.error('查询数据失败:', error);
  }
}

// 查询所有应用域
async function getAppDomain() {
  try {
    const res = await getAllAppDomain();
    if (res) {
      appDomains.value = [...new Set(res)]; 
    }
  } catch (error) {
    console.error('查询数据失败:', error);
  }
}

// 重置查询
function reset() {
  queryFormRef.value?.resetFields();
  queryData();
}


// 分页查询
function currentChange(val: any) {
  data.pageInfo.pageNo = val;
  queryData();
}

function handleSizeChange(val: number) {
  data.pageInfo.pageSize = val;
  queryData();
}
</script>
<template>
  <div>
    <div style="padding: 0 20px">
      <ElForm
        :inline="true"
        ref="queryFormRef"
        :model="queryForm"
        label-position="left"
      >
        <ElFormItem label="网络分区:" prop="systemNetworkPartition">
          <ElInput v-model="queryForm.systemNetworkPartition" clearable />
        </ElFormItem>
        <ElFormItem label="应用域:" prop="appDomainName">
          <ElSelect v-model="queryForm.appDomainName" placeholder="请选择" style="width:180px;">
            <el-option
              v-for="(item, index) in appDomains"
              :key="index"
              :label="item"
              :value="item"
            />
          </ElSelect>
        </ElFormItem>
        <ElFormItem label="系统名称:" prop="systemName">
          <ElInput v-model="queryForm.systemName" clearable />
        </ElFormItem>
        <ElFormItem label="IP地址:" prop="ipAddress">
          <ElInput v-model="queryForm.ipAddress" clearable />
        </ElFormItem>
        <ElFormItem style="width: auto">
          <ElButton type="primary" :icon="Search" @click="queryData">查询</ElButton>
          <ElButton type="info" :icon="Refresh" @click="reset">重置</ElButton>
        </ElFormItem>
      </ElForm>
    </div>
    <div style="padding: 0 20px 10px 20px">
      <ElTable ref="tab" border stripe :data="data.tableData" height="710px">
        <ElTableColumn type="index" />
        <ElTableColumn type="selection" />
        <ElTableColumn prop="appDomainName" align="center" label="应用域名称" />
        <ElTableColumn
          prop="ipAddress"
          align="center"
          label="IP地址"
        />
        <ElTableColumn
          prop="systemName"
          align="center"
          label="系统名称"
        />
        <ElTableColumn
          prop="systemNetworkPartition"
          align="center"
          label="网络分区"
        />
        <ElTableColumn
          prop="systemRunFlag"
          align="center"
          label="系统在运情况"
        />
      </ElTable>
    </div>
    <div style="padding-left: 20px; display: flex">
      <ElPagination
        v-model:current-page="data.pageInfo.pageNo"
        v-model:page-size="data.pageInfo.pageSize"
        :total="data.pageInfo.total"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="currentChange"
      />
    </div>
  </div>
</template>
<style lang="less" scoped>
// :deep(.el-form-item) {
//   width: 270px;
//   .el-form-item__content {
//     display: flex;
//     justify-content: flex-end;
//   }
//   .el-form-item__label {
//     width: 100px;
//     text-align: right;
//     font-size: 14px;
//     font-weight: 500;
//     // line-height: 32px;
//     color: #515a6e;
//   }
// }
</style>
